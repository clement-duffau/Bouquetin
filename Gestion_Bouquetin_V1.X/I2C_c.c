//
//
//////////////////////////////////////////////////////////////////////
//
//                 Inclusion de fichiers externes
//
//////////////////////////////////////////////////////////////////////
//
#include "Headers_application.h"
//
//
//////////////////////////////////////////////////////////////////////
//
//                 Déclaration de variables
//
//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
//
//                 Fonctions I2C
//
//////////////////////////////////////////////////////////////////////
//
void delais_i2c(unsigned int val)
{
    unsigned int a;
    for(a=0;a<val;a++)
        {
        Nop();
        }
}
//
#ifdef I2C1_USE
unsigned int brg_i2c_1=10000;
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction open I2C 
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int open_i2c_1_master7(unsigned long bdr) //Ouverure I2C 1 en mode master 7 bits d'adresse sans interruptions
{
float a;
    a=(float)(bdr);
    a=(horloge_bus_UC/(10.8*a));
    brg_i2c_1=(unsigned int)(a);  
    scl_1=1;                      //Relache le bus
    sdao_1=1;
    stop_1();
    return(0);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction start I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void start_1 (void)           //Fonction start
{
 sdao_1=1;
    scl_1=1;
    delais_i2c(brg_i2c_1);     // tempo 5µs
    sdao_1=0;
    delais_i2c(brg_i2c_1);     // tempo 5µs
    scl_1=0;       //scl à 0
    delais_i2c(brg_i2c_1);      //tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Restart I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void restart_1 (void)           //Fonction start
{
sdao_1=1;
    scl_1=1;
    delais_i2c(brg_i2c_1); 
    sdao_1=0;
    delais_i2c(brg_i2c_1);      // tempo 5µs
    scl_1=0;
    delais_i2c(brg_i2c_1);     // tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Stop I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void stop_1 (void)           //Fonction start
    {
    sdao_1=0;
    delais_i2c(brg_i2c_1);     // tempo 5µs
    scl_1=1;
    delais_i2c(brg_i2c_1);      // tempo 5µs
    sdao_1=1;
    delais_i2c(brg_i2c_1);     // tempo 5µs
    }
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction NACK I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void nack_1 (void)           //Fonction start
    {
    sdao_1=1;
    clock_1();
    }
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Read I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
unsigned char read_1 (void)           //Fonction start
{
 unsigned char a,b;
    for(a=0;a<8;a++)     //Lecture des 8 bits de données
    {
        b=(b<<1);
        scl_1=1;          //sda à 1
        delais_i2c(brg_i2c_1);      // tempo 5µs
        if (sda_1==1)    //lecture bit
            {
            b|=0x01;
            }
        else
            {
            b&=0xFE;
            }
        scl_1=0;
        delais_i2c(brg_i2c_1);      // tempo 5µs
    }
    return(b);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Write I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int write_1 (unsigned char val) //Fonction start
{
    unsigned char a;
    int ret_func;
    for(a=0;a<8;a++)
    {
        if ((val&0x80)==0)
            {
            sdao_1=0;
            }
        else
            {
            sdao_1=1;
            }
        clock_1();
        val=(val<<1);
    }
    sdao_1=1;
    scl_1=1;
    delais_i2c(brg_i2c_1);      // tempo 5µs
    ret_func=sda_1;
    scl_1=0;
    delais_i2c(brg_i2c_1);      // tempo 5µs
    return(ret_func);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction ACK I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void ack_1 (void)           //Fonction start
{
sdao_1=0;
    clock_1();
    sdao_1=1;
    delais_i2c(brg_i2c_1); 
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Horloge I2C
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void clock_1 (void)           //Fonction start
{
    delais_i2c(brg_i2c_1);      // tempo 5µs
    scl_1=1;
    delais_i2c(brg_i2c_1);     // tempo 5µs
    scl_1=0;
    delais_i2c(brg_i2c_1);      // tempo 5µs
}
//
//
#endif
//
#ifdef I2C2_USE
unsigned int brg_i2c_2=10000;
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction open I2C 
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int open_i2c_2_master7(unsigned long bdr) //Ouverure I2C 1 en mode master 7 bits d'adresse sans interruptions
{
    float a;
    a=(float)(bdr);
    a=(horloge_bus_UC/(9*a));
    brg_i2c_2=(unsigned int)(a);
scl_2=1;         //Relache le bus
sdao_2=1;
stop_2();
return(0);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction start I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void start_2 (void)           //Fonction start
{
 sdao_2=1;
    scl_2=1;
    delais_i2c(brg_i2c_2);     // tempo 5µs
    sdao_2=0;
    delais_i2c(brg_i2c_2);     // tempo 5µs
    scl_2=0;       //scl à 0
    delais_i2c(brg_i2c_2);      //tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Restart I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void restart_2 (void)           //Fonction start
{
sdao_2=1;
    scl_2=1;
    delais_i2c(brg_i2c_2); 
    sdao_2=0;
    delais_i2c(brg_i2c_2);      // tempo 5µs
    scl_2=0;
    delais_i2c(brg_i2c_2);     // tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Stop I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void stop_2 (void)           //Fonction start
{
sdao_2=0;
    delais_i2c(brg_i2c_2);     // tempo 5µs
    scl_2=1;
    delais_i2c(brg_i2c_2);      // tempo 5µs
    sdao_2=1;
    delais_i2c(brg_i2c_2);     // tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction NACK I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void nack_2 (void)           //Fonction start
{
sdao_2=1;
clock_2();
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Read I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
unsigned char read_2 (void)           //Fonction start
{
 unsigned char a,b;
    for(a=0;a<8;a++)     //Lecture des 8 bits de données
    {
        b=(b<<1);
        scl_2=1;          //sda à 1
        delais_i2c(brg_i2c_2);      // tempo 5µs
        if (sda_2==1)    //lecture bit
            {
            b|=0x01;
            }
        else
            {
            b&=0xFE;
            }
        scl_2=0;
        delais_i2c(brg_i2c_2);      // tempo 5µs
    }
    return(b);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Write I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int write_2 (unsigned char val) //Fonction start
{
    unsigned char a;
    int ret_func;
    for(a=0;a<8;a++)
    {
        if ((val&0x80)==0)
            {
            sdao_2=0;
            }
        else
            {
            sdao_2=1;
            }
        clock_2();
        val=(val<<1);
    }
    sdao_2=1;
    scl_2=1;
    delais_i2c(brg_i2c_2);      // tempo 5µs
    ret_func=sda_2;
    scl_2=0;
    delais_i2c(brg_i2c_2);      // tempo 5µs
    return(ret_func);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction ACK I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void ack_2 (void)           //Fonction start
{
sdao_2=0;
    clock_2();
    sdao_2=1;
    delais_i2c(brg_i2c_2); 
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Horloge I2C
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void clock_2 (void)           //Fonction start
{
    delais_i2c(brg_i2c_2);      // tempo 5µs
    scl_2=1;
    delais_i2c(brg_i2c_2);     // tempo 5µs
    scl_2=0;
    delais_i2c(brg_i2c_2);      // tempo 5µs
}
//
//
#endif
//
//
#ifdef I2C3_USE
unsigned int brg_i2c_3=10000;
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction open I2C 
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int open_i2c_3_master7(unsigned long bdr) //Ouverure I2C 1 en mode master 7 bits d'adresse sans interruptions
{
    float a;
    a=(float)(bdr);
    a=(horloge_bus_UC/(9*a));
    brg_i2c_3=(unsigned int)(a);
scl_3=1;         //Relache le bus
sdao_3=1;
stop_3();
return(0);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction start I2C 
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void start_3 (void)           //Fonction start
{
 sdao_3=1;
    scl_3=1;
    delais_i2c(brg_i2c_3);     // tempo 5µs
    sdao_3=0;
    delais_i2c(brg_i2c_3);     // tempo 5µs
    scl_3=0;       //scl à 0
    delais_i2c(brg_i2c_3);      //tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Restart I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void restart_3 (void)           //Fonction start
{
sdao_3=1;
    scl_3=1;
    delais_i2c(brg_i2c_3); 
    sdao_3=0;
    delais_i2c(brg_i2c_3);      // tempo 5µs
    scl_3=0;
    delais_i2c(brg_i2c_3);     // tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Stop I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void stop_3 (void)           //Fonction start
{
sdao_3=0;
    delais_i2c(brg_i2c_3);     // tempo 5µs
    scl_3=1;
    delais_i2c(brg_i2c_3);      // tempo 5µs
    sdao_3=1;
    delais_i2c(brg_i2c_3);     // tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction NACK I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void nack_3 (void)           //Fonction start
{
sdao_3=1;
clock_3();
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Read I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
unsigned char read_3 (void)           //Fonction start
{
 unsigned char a,b;
    for(a=0;a<8;a++)     //Lecture des 8 bits de données
    {
        b=(b<<1);
        scl_3=1;          //sda à 1
        delais_i2c(brg_i2c_3);      // tempo 5µs
        if (sda_3==1)    //lecture bit
            {
            b|=0x01;
            }
        else
            {
            b&=0xFE;
            }
        scl_3=0;
        delais_i2c(brg_i2c_3);      // tempo 5µs
    }
    return(b);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Write I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int write_3 (unsigned char val) //Fonction start
{
    unsigned char a;
    int ret_func;
    for(a=0;a<8;a++)
    {
        if ((val&0x80)==0)
            {
            sdao_3=0;
            }
        else
            {
            sdao_3=1;
            }
        clock_3();
        val=(val<<1);
    }
    sdao_3=1;
    scl_3=1;
    delais_i2c(brg_i2c_3);      // tempo 5µs
    ret_func=sda_3;
    scl_3=0;
    delais_i2c(brg_i2c_3);      // tempo 5µs
    return(ret_func);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction ACK I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void ack_3 (void)           //Fonction start
{
sdao_3=0;
    clock_3();
    sdao_3=1;
    delais_i2c(brg_i2c_3); 
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Horloge I2C
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void clock_3 (void)           //Fonction start
{
    delais_i2c(brg_i2c_3);      // tempo 5µs
    scl_3=1;
    delais_i2c(brg_i2c_3);     // tempo 5µs
    scl_3=0;
    delais_i2c(brg_i2c_3);      // tempo 5µs
}
//
//
#endif
//
#ifdef I2C4_USE
unsigned int brg_i2c_4=10000;
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction open I2C 
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int open_i2c_4_master7(unsigned long bdr) //Ouverure I2C 1 en mode master 7 bits d'adresse sans interruptions
{
    float a;
    a=(float)(bdr);
    a=(horloge_bus_UC/(9*a));
    brg_i2c_4=(unsigned int)(a);
scl_4=1;         //Relache le bus
sdao_4=1;
stop_4();
return(0);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction start I2C 
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void start_4 (void)           //Fonction start
{
 sdao_4=1;
    scl_4=1;
    delais_i2c(brg_i2c_4);     // tempo 5µs
    sdao_4=0;
    delais_i2c(brg_i2c_4);     // tempo 5µs
    scl_4=0;       //scl à 0
    delais_i2c(brg_i2c_4);      //tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Restart I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void restart_4 (void)           //Fonction start
{
sdao_4=1;
    scl_4=1;
    delais_i2c(brg_i2c_4); 
    sdao_4=0;
    delais_i2c(brg_i2c_4);      // tempo 5µs
    scl_4=0;
    delais_i2c(brg_i2c_4);     // tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Stop I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void stop_4 (void)           //Fonction start
{
sdao_4=0;
    delais_i2c(brg_i2c_4);     // tempo 5µs
    scl_4=1;
    delais_i2c(brg_i2c_4);      // tempo 5µs
    sdao_4=1;
    delais_i2c(brg_i2c_4);     // tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction NACK I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void nack_4 (void)           //Fonction start
{
sdao_4=1;
clock_4();
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Read I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
unsigned char read_4 (void)           //Fonction start
{
 unsigned char a,b;
    for(a=0;a<8;a++)     //Lecture des 8 bits de données
    {
        b=(b<<1);
        scl_4=1;          //sda à 1
        delais_i2c(brg_i2c_4);      // tempo 5µs
        if (sda_4==1)    //lecture bit
            {
            b|=0x01;
            }
        else
            {
            b&=0xFE;
            }
        scl_4=0;
        delais_i2c(brg_i2c_4);      // tempo 5µs
    }
    return(b);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Write I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int write_4 (unsigned char val) //Fonction start
{
    unsigned char a;
    int ret_func;
    for(a=0;a<8;a++)
    {
        if ((val&0x80)==0)
            {
            sdao_4=0;
            }
        else
            {
            sdao_4=1;
            }
        clock_4();
        val=(val<<1);
    }
    sdao_4=1;
    scl_4=1;
    delais_i2c(brg_i2c_4);      // tempo 5µs
    ret_func=sda_4;
    scl_4=0;
    delais_i2c(brg_i2c_4);      // tempo 5µs
    return(ret_func);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction ACK I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void ack_4 (void)           //Fonction start
{
sdao_4=0;
    clock_4();
    sdao_4=1;
    delais_i2c(brg_i2c_4); 
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Horloge I2C
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void clock_4 (void)           //Fonction start
{
    delais_i2c(brg_i2c_4);      // tempo 5µs
    scl_4=1;
    delais_i2c(brg_i2c_4);     // tempo 5µs
    scl_4=0;
    delais_i2c(brg_i2c_4);      // tempo 5µs
}
//
//
#endif
//
#ifdef I2C5_USE
unsigned int brg_i2c_5=10000;
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction open I2C 
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int open_i2c_5_master7(unsigned long bdr) //Ouverure I2C 1 en mode master 7 bits d'adresse sans interruptions
{
    float a;
    a=(float)(bdr);
    a=(horloge_bus_UC/(9*a));
    brg_i2c_5=(unsigned int)(a);
scl_5=1;         //Relache le bus
sdao_5=1;
stop_5();
return(0);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction start I2C 
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void start_5 (void)           //Fonction start
{
 sdao_5=1;
    scl_5=1;
    delais_i2c(brg_i2c_5);     // tempo 5µs
    sdao_5=0;
    delais_i2c(brg_i2c_5);     // tempo 5µs
    scl_5=0;       //scl à 0
    delais_i2c(brg_i2c_5);      //tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Restart I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void restart_5 (void)           //Fonction start
{
sdao_5=1;
    scl_5=1;
    delais_i2c(brg_i2c_5); 
    sdao_5=0;
    delais_i2c(brg_i2c_5);      // tempo 5µs
    scl_5=0;
    delais_i2c(brg_i2c_5);     // tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Stop I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void stop_5 (void)           //Fonction start
{
sdao_5=0;
    delais_i2c(brg_i2c_5);     // tempo 5µs
    scl_5=1;
    delais_i2c(brg_i2c_5);      // tempo 5µs
    sdao_5=1;
    delais_i2c(brg_i2c_4);     // tempo 5µs
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction NACK I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void nack_5 (void)           //Fonction start
{
sdao_5=1;
clock_5();
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Read I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
unsigned char read_5 (void)           //Fonction start
{
 unsigned char a,b;
    for(a=0;a<8;a++)     //Lecture des 8 bits de données
    {
        b=(b<<1);
        scl_5=1;          //sda à 1
        delais_i2c(brg_i2c_5);      // tempo 5µs
        if (sda_5==1)    //lecture bit
            {
            b|=0x01;
            }
        else
            {
            b&=0xFE;
            }
        scl_5=0;
        delais_i2c(brg_i2c_5);      // tempo 5µs
    }
    return(b);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Write I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int write_5 (unsigned char val) //Fonction start
{
    unsigned char a;
    int ret_func;
    for(a=0;a<8;a++)
    {
        if ((val&0x80)==0)
            {
            sdao_5=0;
            }
        else
            {
            sdao_5=1;
            }
        clock_5();
        val=(val<<1);
    }
    sdao_5=1;
    scl_5=1;
    delais_i2c(brg_i2c_5);      // tempo 5µs
    ret_func=sda_5;
    scl_5=0;
    delais_i2c(brg_i2c_5);      // tempo 5µs
    return(ret_func);
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction ACK I2C 2
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void ack_5 (void)           //Fonction start
{
sdao_5=0;
    clock_5();
    sdao_5=1;
    delais_i2c(brg_i2c_5); 
}
//
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//                      Fonction Horloge I2C
//
//////////////////////////////////////////////////////////////////////////////////////////////////
//
//
void clock_5 (void)           //Fonction start
{
    delais_i2c(brg_i2c_5);      // tempo 5µs
    scl_5=1;
    delais_i2c(brg_i2c_5);     // tempo 5µs
    scl_5=0;
    delais_i2c(brg_i2c_5);      // tempo 5µs
}
//
//
#endif
//